###################################################################################################################
#   Automated Force Fields for Metals     /$$$$$$$   /$$$$$$  /$$$$$$$  /$$      /$$                              # 
#                                        | $$__  $$ /$$__  $$| $$__  $$| $$$    /$$$                              #
#   /$$$$$$   /$$$$$$   /$$$$$$$ /$$   /$$| $$  \ $$| $$  \ $$| $$  \ $$| $$$$  /$$$$                             #
#  /$$__  $$ |____  $$ /$$_____/| $$  | $$| $$$$$$$/| $$$$$$$$| $$$$$$$/| $$ $$/$$ $$                             #
# | $$$$$$$$  /$$$$$$$|  $$$$$$ | $$  | $$| $$____/ | $$__  $$| $$__  $$| $$  $$$| $$                             #
# | $$_____/ /$$__  $$ \____  $$| $$  | $$| $$      | $$  | $$| $$  \ $$| $$\  $ | $$                             #
# |  $$$$$$$|  $$$$$$$ /$$$$$$$/|  $$$$$$$| $$      | $$  | $$| $$  | $$| $$ \/  | $$                             #
#  \_______/ \_______/|_______/  \____  $$|__/      |__/  |__/|__/  |__/|__/     |__/                             #
#                               /$$  | $$                                                                         #
#                              |  $$$$$$/              Ver. 4.15 - 17 October 2025                                #
#                               \______/                                                                          #
#                                                                                                                 #
# Developer: Abdelazim M. A. Abdelgawwad.                                                                         #
# Institut de Ciència Molecular (ICMol), Universitat de València, P.O. Box 22085, València 46071, Spain           #
#                                                                                                                 #
#Distributed under the GNU LESSER GENERAL PUBLIC LICENSE Version 2.1, February 1999                               #
#Copyright 2024 Abdelazim M. A. Abdelgawwad, Universitat de València. E-mail: abdelazim.abdelgawwad@uv.es         #
###################################################################################################################

#!/bin/bash

# Get the directory of the bash script
SCRIPT_DIR=$(dirname "$(realpath "$0")")

# Remove the existing COMPLEX_modified.frcmod file if it exists
file_name="COMPLEX_modified.frcmod"

if [ -f "$file_name" ]; then
    rm "$file_name"
fi

case "$2" in
    1)
        s_value=3
        ;;
    2)
        s_value=1
        ;;
    3)
        s_value=2
        ;;
    *)
        exit 1
        ;;
esac

# Run the Python script using the directory of the bash script
python3 "$SCRIPT_DIR/generate_preforcefield.py"

# Run parmchk2 with the appropriate parameters
parmchk2 -i COMPLEX_modified.mol2 -f mol2 -o COMPLEX_modified.frcmod -a Y -s $s_value > temp.dat 2>&1

# Run the Python script again
python3 "$SCRIPT_DIR/generate_preforcefield.py"

